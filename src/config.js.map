{"version":3,"file":"config.js","sourceRoot":"","sources":["config.ts"],"names":[],"mappings":"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","sourcesContent":["import { EpubMaker, ISlugify, slugify } from './index';\nimport { shortid, hashSum, moment, array_unique } from './lib/util';\nimport { crlf, chkcrlf, LF, CRLF, CR } from 'crlf-normalize';\n\nimport { deepmerge, deepmergeOptions } from 'node-novel-info/lib';\nimport { htmlPreface } from './lib/util';\nimport { createUUID } from './lib/uuid';\nimport { encode as encodeHE } from 'he';\n\nexport interface ICover extends IFiles\n{\n\trights?: IRightsConfig,\n}\n\nexport interface IStylesheet extends IFiles\n{\n\tstyles?: string,\n\treplaceOriginal?: boolean,\n}\n\nexport interface IRightsConfig\n{\n\tdescription?: string,\n\tlicense?: string,\n}\n\nexport interface IFiles\n{\n\turl?: string,\n\tfile?: string,\n\n\tfolder?: string,\n\tname?: string,\n\n\tbasename?: string,\n\text?: string,\n\tmime?: string,\n\tdata?;\n\n\tis?: string,\n\thref?: string,\n}\n\nexport interface ICollection\n{\n\tname?: string,\n\ttype?: string,\n\tposition?: number,\n}\n\nexport interface IEpubConfig\n{\n\tuuid?: string;\n\ttemplateName?: string;\n\n\tfilename?: string;\n\n\ttitle?: string;\n\ttitle_short?: string,\n\ttitles?: string[];\n\n\tslug?: string;\n\n\tlang?: string;\n\n\tauthor?: string;\n\tauthorUrl?: string;\n\tauthors?: {\n\t\t[index: string]: string,\n\t};\n\tauthorsJSON?: string;\n\n\tpublisher?: string;\n\n\trights?: IRightsConfig;\n\n\tcover?: ICover;\n\tcwd?: string;\n\n\tidentifiers?: string[];\n\n\tattributionUrl?: string;\n\tstylesheet?: IStylesheet;\n\tsections?: EpubMaker.Section[];\n\ttoc?: EpubMaker.Section[];\n\tlandmarks?: EpubMaker.Section[];\n\toptions?;\n\tadditionalFiles?: IFiles[];\n\n\tmodification?: moment.Moment;\n\tmodificationDate?: string;\n\tmodificationDateYMD?: string;\n\tpublication?: moment.Moment;\n\tpublicationDate?: string;\n\tpublicationDateYMD?: string;\n\n\t/**\n\t * <meta property=\"belongs-to-collection\" id=\"id-2\">黒の魔王WEB</meta>\n\t * <meta refines=\"#id-2\" property=\"collection-type\">series</meta>\n\t * <meta refines=\"#id-2\" property=\"group-position\">1</meta>\n\t */\n\tcollection?: ICollection;\n\n\t/**\n\t * <dc:subject>\n\t */\n\ttags?: string[];\n\n\tinfoPreface?: string;\n\tinfoPrefaceHTML?: string;\n\n\tlinks?: EpubMetaLink[],\n\n\tvertical?: boolean | EnumEpubConfigVertical,\n}\n\nexport enum EnumEpubConfigVertical\n{\n\tNONE = 0,\n\tVERTICAL_RL = 1\n}\n\nexport interface EpubMetaLink\n{\n\thref: string,\n\trel: string,\n\tid?: string,\n\trefines: string,\n\t'media-type': string,\n}\n\nexport class EpubConfig implements IEpubConfig\n{\n\tuuid?: string;\n\ttemplateName?: string;\n\n\tfilename?: string;\n\n\ttitle?: string;\n\ttitle_short?: string;\n\n\ttitles?: string[];\n\n\tslug?: string;\n\n\tlang?: string;\n\n\tauthor?: string;\n\tauthorUrl?: string;\n\tauthors?: Record<string, string>;\n\tauthorsJSON?: string;\n\n\tpublisher?: string;\n\n\trights?: IRightsConfig;\n\n\tcover?: ICover;\n\tcwd?: string;\n\n\tidentifiers?: string[];\n\n\tattributionUrl?: string;\n\tstylesheet?: IStylesheet;\n\tsections?: EpubMaker.Section[];\n\ttoc?: EpubMaker.Section[];\n\tlandmarks?: EpubMaker.Section[];\n\toptions?: {\n\t\tlibSlugify?: ISlugify,\n\t\text?: string,\n\t\tgenerateOptions?,\n\t};\n\tadditionalFiles?: IFiles[];\n\n\tmodification?: moment.Moment;\n\tmodificationDate?: string;\n\tmodificationDateYMD?: string;\n\tpublication?: moment.Moment;\n\tpublicationDate?: string;\n\tpublicationDateYMD?: string;\n\n\t/**\n\t * <meta property=\"belongs-to-collection\" id=\"id-2\">黒の魔王WEB</meta>\n\t * <meta refines=\"#id-2\" property=\"collection-type\">series</meta>\n\t * <meta refines=\"#id-2\" property=\"group-position\">1</meta>\n\t */\n\tcollection?: ICollection;\n\n\t/**\n\t * <dc:subject>\n\t */\n\ttags?: string[];\n\n\tinfoPreface?: string;\n\tinfoPrefaceHTML?: string;\n\n\tlinks?: EpubMetaLink[];\n\n\t/**\n\t * 輸出成 直排\n\t */\n\tvertical?: boolean | EnumEpubConfigVertical;\n\n\tconstructor(epubConfig: IEpubConfig = {}, options: any = {})\n\t{\n\t\tif (epubConfig instanceof EpubConfig)\n\t\t{\n\t\t\tepubConfig = epubConfig.entries(false);\n\n\t\t\tdelete epubConfig.slug;\n\t\t\tdelete epubConfig.uuid;\n\t\t}\n\n\t\tObject.assign(this, EpubConfig.getDefaultEpubConfig(), deepmerge.all([{}, epubConfig, {\n\t\t\toptions\n\t\t}], deepmergeOptions));\n\t}\n\n\tget langMain()\n\t{\n\t\treturn this.lang;\n\t}\n\n\tget subjects(): string[]\n\t{\n\t\treturn this.tags;\n\t}\n\n\tset subjects(val: string[])\n\t{\n\t\tthis.tags = val;\n\t}\n\n\tsetModification(val, ...argv)\n\t{\n\t\tlet data;\n\n\t\tif (val === true)\n\t\t{\n\t\t\tdata = moment();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdata = moment(val, ...argv);\n\t\t}\n\n\t\tlet self = this as IEpubConfig;\n\t\tself.modification = data.local();\n\n\t\treturn this;\n\t}\n\n\tsetPublication(val, ...argv)\n\t{\n\t\tlet data;\n\n\t\tif (val === true)\n\t\t{\n\t\t\tdata = moment();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdata = moment(val, ...argv);\n\t\t}\n\n\t\tlet self = this as IEpubConfig;\n\t\tself.publication = data.local();\n\n\t\treturn this;\n\t}\n\n\taddAuthor(name: string, url: string = null)\n\t{\n\t\tif (!name)\n\t\t{\n\t\t\tthrow new ReferenceError();\n\t\t}\n\n\t\tlet self = this as IEpubConfig;\n\n\t\tself.authors = self.authors || {};\n\n\t\tself.authors[name] = url;\n\n\t\treturn this;\n\t}\n\n\taddLink(data: EpubMetaLink | string, rel?: string)\n\t{\n\t\trel = (rel || (<EpubMetaLink>data).rel) as string;\n\n\t\tif (typeof data == 'string')\n\t\t{\n\t\t\tdata = {\n\t\t\t\thref: data.toString(),\n\t\t\t\trel,\n\t\t\t} as EpubMetaLink;\n\t\t}\n\n\t\tlet link = Object.assign({\n\t\t\thref: '',\n\t\t\trel: '',\n\t\t\tid: '',\n\t\t\trefines: '',\n\t\t\t'media-type': '',\n\t\t} as EpubMetaLink, data);\n\n\t\tlink.href = (link.href || data.href || '').toString();\n\t\tlink.rel = link.rel || rel || data.rel || 'link-' + hashSum(link);\n\n\t\tthis.links = this.links || [];\n\t\tthis.links.push(link);\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * isbn:xxx\n\t * calibre:xxx\n\t * uuid:xxx\n\t *\n\t * @param {string} type\n\t * @param {string} id\n\t * @returns {this}\n\t */\n\taddIdentifier(type: string, id?: string)\n\t{\n\t\tthis.identifiers = this.identifiers || [];\n\n\t\tlet ids = [];\n\n\t\tif (type && type !== '')\n\t\t{\n\t\t\tids.push(type.toString());\n\t\t}\n\t\tif (id && id !== '')\n\t\t{\n\t\t\tids.push(id.toString());\n\t\t}\n\n\t\tif (!ids.length)\n\t\t{\n\t\t\tthrow new ReferenceError();\n\t\t}\n\n\t\tthis.identifiers.push(ids.join(':'));\n\n\t\treturn this;\n\t}\n\n\tsetVertical(vertical?: boolean | EnumEpubConfigVertical)\n\t{\n\t\tif (vertical === true)\n\t\t{\n\t\t\tvertical = EnumEpubConfigVertical.VERTICAL_RL;\n\t\t}\n\n\t\tthis.vertical = vertical || 0;\n\n\t\treturn this;\n\t}\n\n\t$clone()\n\t{\n\t\t// @ts-ignore\n\t\treturn new (this.__proto__.constructor)(this);\n\t}\n\n\tstatic $create(epubConfig: IEpubConfig = {}, options: any = {})\n\t{\n\t\treturn new this(epubConfig, options)\n\t}\n\n\t$auto()\n\t{\n\t\tlet self = this as IEpubConfig;\n\n\t\tself.tags = self.tags || [];\n\n\t\t[\n\t\t\tself.tags,\n\t\t].forEach(a => (a || []).filter(v => v).map(v => v.toString()));\n\n\t\t{\n\t\t\tif (self.authors)\n\t\t\t{\n\t\t\t\tself.author = self.author || Object.keys(self.authors)[0];\n\t\t\t\tself.authorUrl = self.authorUrl || self.authors[self.author];\n\t\t\t}\n\n\t\t\tif (self.author)\n\t\t\t{\n\t\t\t\tlet o = {};\n\n\t\t\t\to[self.author] = (self.authorUrl || '').toString();\n\n\t\t\t\tself.authors = Object.assign(o, self.authors, o);\n\t\t\t}\n\n\t\t\tif (self.authors && Object.keys(self.authors).length)\n\t\t\t{\n\t\t\t\tfor (let name in self.authors)\n\t\t\t\t{\n\t\t\t\t\tself.authors[name] = (self.authors[name] || '').toString();\n\n\t\t\t\t\tself.tags.push(name);\n\t\t\t\t}\n\n\t\t\t\t/**\n\t\t\t\t * 防止名稱含有造成 epub 錯誤的狀況\n\t\t\t\t */\n\t\t\t\tlet encodeAuthors = Object.entries(self.authors)\n\t\t\t\t\t.reduce((a, b) => {\n\n\t\t\t\t\t\tlet [key, value] = b.map(v => v && encodeHE(`${v}`) || v);\n\n\t\t\t\t\t\ta[key] = value;\n\n\t\t\t\t\t\treturn a;\n\t\t\t\t\t}, {} as EpubConfig[\"authors\"])\n\t\t\t\t;\n\n\t\t\t\tself.authorsJSON = JSON.stringify(encodeAuthors);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tself.authors = null;\n\t\t\t}\n\t\t}\n\n\t\tif (self.publisher)\n\t\t{\n\t\t\tself.tags.push(self.publisher);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tself.publisher = 'epub-maker2';\n\t\t}\n\n\t\t{\n\t\t\tself.tags.push('epub-maker2');\n\n\t\t\tif (self.tags)\n\t\t\t{\n\t\t\t\tself.tags = array_unique(self.tags);\n\t\t\t}\n\t\t}\n\n\t\tif (self.titles)\n\t\t{\n\t\t\tself.titles = self.titles.filter(v => v && v != self.title && v != self.title_short);\n\n\t\t\tself.titles = array_unique(self.titles);\n\t\t}\n\n\t\tself.uuid = (self.uuid && typeof self.uuid == 'string') ? self.uuid : createUUID(self);\n\t\tself.slug = self.slug\n\t\t\t// @ts-ignore\n\t\t\t|| slugify(self.title)\n\t\t\t|| hashSum(self.title)\n\t\t;\n\n\t\tif (!self.modification)\n\t\t{\n\t\t\tself.modification = self.publication.clone();\n\t\t}\n\n\t\tif (self.modification)\n\t\t{\n\t\t\tself.modificationDate = self.modification.format('YYYY-MM-DDThh:mm:ss') + 'Z';\n\t\t\tself.modificationDateYMD = self.modification.format('YYYY-MM-DD');\n\t\t}\n\n\t\tif (!self.publication)\n\t\t{\n\t\t\tthis.setPublication(true);\n\t\t}\n\n\t\tif (self.infoPreface)\n\t\t{\n\t\t\t/*\n\t\t\tself.infoPreface = crlf(self.infoPreface).replace(/[ \\t\\uFEFF\\xA0　]+$/gm, '');\n\n\t\t\tself.infoPrefaceHTML = self.infoPrefaceHTML || self.infoPreface.replace(/\\n/g, '<br/>')\n\t\t\t*/\n\t\t\thtmlPreface(self);\n\t\t}\n\n\t\t//console.log(self.infoPreface, self.infoPrefaceHTML);\n\n\t\tself.publicationDate = self.publication.format(EpubConfig.dateFormat);\n\t\tself.publicationDateYMD = self.publication.format('YYYY-MM-DD');\n\n\t\tif (self.collection || 1)\n\t\t{\n\t\t\tself.collection.name = self.collection.name || self.title;\n\t\t\tself.collection.position = self.collection.position || 1;\n\t\t\tself.collection.type = self.collection.type || 'series';\n\t\t}\n\n\t\tthis.setVertical(self.vertical);\n\n\t\treturn this;\n\t}\n\n\tentries(auto = true): IEpubConfig\n\t{\n\t\tif (auto)\n\t\t{\n\t\t\tthis.$auto();\n\t\t}\n\n\t\treturn Object.entries(this)\n\t\t\t.reduce(function (a, b)\n\t\t\t{\n\t\t\t\ta[b[0]] = b[1];\n\n\t\t\t\treturn a;\n\t\t\t}, {})\n\t\t;\n\t}\n\n\ttoJSON(auto?: boolean, replacer = null, space = \"\\t\"): string\n\t{\n\t\tif (auto)\n\t\t{\n\t\t\tthis.$auto();\n\t\t}\n\n\t\treturn JSON.stringify(this.entries(), replacer, space);\n\t}\n\n\ttoArray(auto?: boolean)\n\t{\n\t\tif (auto)\n\t\t{\n\t\t\tthis.$auto();\n\t\t}\n\n\t\treturn Object.entries(this);\n\t}\n\n}\n\nexport namespace EpubConfig\n{\n\texport let dateFormat = 'YYYY-MM-DDTHH:mm:ss.SSSZ';\n\n\texport function getDefaultEpubConfig()\n\t{\n\t\treturn {\n\t\t\ttoc: [],\n\t\t\tlandmarks: [],\n\t\t\tsections: [],\n\t\t\tstylesheet: {},\n\t\t\tadditionalFiles: [],\n\t\t\toptions: {},\n\t\t};\n\t}\n\n\texport let defaultEpubConfig = getDefaultEpubConfig();\n}\n\n//let a = new EpubConfig({lang: 'zh'});\n//\n//a.addAuthor('菱影代理');\n//\n//a.setPublication(true);\n//\n//let b = new EpubConfig(a);\n//\n//a.lang = 'jp';\n//\n//console.log(a, b.$auto());\n\n// @ts-ignore\nexport default EpubConfig as EpubConfig;\n"]}