{"version":3,"file":"index.js","sourceRoot":"","sources":["index.ts"],"names":[],"mappings":"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","sourcesContent":["import * as _slugify from 'slugify';\nimport { TemplateManagers, templateManagers } from './template';\nimport { trimFilename } from 'fs-iconv';\nimport * as path from 'path';\nimport { parseFileSetting } from './epubtpl-lib/zip';\nimport { createUUID } from './lib/uuid';\nimport {\n\tEpubConfig,\n\tIEpubConfig,\n\tICover,\n\tIRightsConfig,\n\tIFiles,\n\tIStylesheet,\n\tICollection,\n\tEnumEpubConfigVertical,\n} from './config';\nimport JSZip = require('jszip');\nimport { shortid, hashSum, moment, BPromise } from './lib/util';\n\nexport { shortid, hashSum }\n\nexport function slugify(input: string, ...argv): string\n{\n\tlet fn = EpubMaker.libSlugify ||\n\t\t// @ts-ignore\n\t\t_slugify as ISlugify\n\t;\n\n\treturn fn(input || '', ...argv).trim();\n}\n\nexport function slugifyWithFallback(input: string, ...argv): string\n{\n\tlet ret = slugify(input, ...argv);\n\n\treturn ret || hashSum(input);\n}\n\nexport class EpubMaker\n{\n\tpublic epubConfig: EpubConfig;\n\n\tconstructor(options = {}, config?: IEpubConfig)\n\t{\n\t\tthis.epubConfig = new EpubConfig(config, options);\n\t}\n\n\tstatic create(options?, ...argv)\n\t{\n\t\treturn new this(options, ...argv);\n\t}\n\n\twithUuid(uuid: string)\n\t{\n\t\tthis.epubConfig.uuid = uuid;\n\t\treturn this;\n\t}\n\n\twithTemplate(templateName)\n\t{\n\t\tthis.epubConfig.templateName = templateName;\n\t\treturn this;\n\t}\n\n\tslugify(input: string, ...argv): string\n\t{\n\t\tlet fn = this.epubConfig.options.libSlugify || slugify;\n\n\t\treturn fn(input || '', ...argv).trim();\n\t}\n\n\tslugifyWithFallback(input: string, ...argv): string\n\t{\n\t\tlet ret = this.slugify(input, ...argv);\n\n\t\treturn ret || hashSum(input);\n\t}\n\n\twithTitle(title: string, title_short?: string)\n\t{\n\t\tthis.epubConfig.title = title;\n\t\t// @ts-ignore\n\t\tthis.epubConfig.slug = this.slugifyWithFallback(title || title_short);\n\n\t\tif (title_short)\n\t\t{\n\t\t\tthis.epubConfig.title_short = title_short;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\taddTitles(titles: string[])\n\t{\n\t\tthis.epubConfig.titles = titles || [];\n\n\t\treturn this;\n\t}\n\n\twithLanguage(lang: string)\n\t{\n\t\tthis.epubConfig.lang = lang;\n\t\treturn this;\n\t}\n\n\tget lang()\n\t{\n\t\treturn this.epubConfig.lang;\n\t}\n\n\twithAuthor(fullName: string, url?: string)\n\t{\n\t\tthis.epubConfig.author = fullName;\n\t\tthis.epubConfig.authorUrl = url;\n\t\treturn this;\n\t}\n\n\taddAuthor(fullName: string, url?: string): this\n\taddAuthor(fullName: string[]): this\n\taddAuthor(fullName: { [key: string]: string; }): this\n\taddAuthor(fullName: string\n\t\t| string[]\n\t\t| { [key: string]: string; }\n\t\t, url?: string\n\t): this\n\t{\n\t\tlet self = this;\n\n\t\tif (Array.isArray(fullName))\n\t\t{\n\t\t\tfullName.forEach(name => {\n\t\t\t\tname && self.epubConfig.addAuthor(name);\n\t\t\t});\n\t\t}\n\t\telse if (typeof fullName == 'object')\n\t\t{\n\t\t\tfor (let name in fullName)\n\t\t\t{\n\t\t\t\tname && self.epubConfig.addAuthor(name, fullName[name]);\n\t\t\t}\n\t\t}\n\t\telse if (fullName)\n\t\t{\n\t\t\tself.epubConfig.addAuthor(fullName as string, url);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\twithPublisher(publisher: string)\n\t{\n\t\tthis.epubConfig.publisher = publisher;\n\t\treturn this;\n\t}\n\n\twithCollection(data: ICollection)\n\t{\n\t\tthis.epubConfig.collection = Object.assign(this.epubConfig.collection || {}, data);\n\n\t\t//console.log(this.epubConfig.collection);\n\n\t\treturn this;\n\t}\n\n\twithSeries(name: string, position = 1)\n\t{\n\t\tif (name)\n\t\t{\n\t\t\tthis.withCollection({\n\t\t\t\tname,\n\t\t\t\tposition,\n\t\t\t\ttype: 'series',\n\t\t\t})\n\t\t}\n\t}\n\n\twithModificationDate(modificationDate, ...argv)\n\t{\n\t\tlet data = moment(modificationDate, ...argv).local();\n\n\t\tthis.epubConfig.modification = data;\n\t\tthis.epubConfig.modificationDate = data.format(EpubMaker.dateFormat);\n\t\tthis.epubConfig.modificationDateYMD = data.format('YYYY-MM-DD');\n\t\treturn this;\n\t}\n\n\twithRights(rightsConfig: IRightsConfig)\n\t{\n\t\tthis.epubConfig.rights = rightsConfig;\n\t\treturn this;\n\t}\n\n\twithCover(coverUrl: string | ICover, rightsConfig?: IRightsConfig)\n\t{\n\t\tlet cover = parseFileSetting(coverUrl, this.epubConfig) as ICover;\n\n\t\tif (cover && rightsConfig)\n\t\t{\n\t\t\tcover.rights = rightsConfig;\n\t\t}\n\n\t\tif (!cover)\n\t\t{\n\t\t\tthrow new ReferenceError();\n\t\t}\n\n\t\tthis.epubConfig.cover = Object.assign(this.epubConfig.cover || {}, cover);\n\n\t\t//this.epubConfig.coverUrl = coverUrl;\n\t\t//this.epubConfig.coverRights = rightsConfig;\n\n\t\treturn this;\n\t}\n\n\twithAttributionUrl(attributionUrl)\n\t{\n\t\tthis.epubConfig.attributionUrl = attributionUrl;\n\t\treturn this;\n\t}\n\n\twithStylesheetUrl(stylesheetUrl, replaceOriginal?: boolean)\n\t{\n\t\tlet data = parseFileSetting(stylesheetUrl, this.epubConfig) as IStylesheet;\n\n\t\tthis.epubConfig.stylesheet = Object.assign(this.epubConfig.stylesheet, data, {\n\t\t\treplaceOriginal: replaceOriginal,\n\t\t});\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * 用來檢查 Section 是否已經加入\n\t */\n\thasSection(section: EpubMaker.Section): boolean\n\t{\n\t\treturn this.epubConfig.sections.includes(section);\n\t}\n\n\twithSection(section: EpubMaker.Section)\n\t{\n\t\tsection.parentEpubMaker = this;\n\n\t\tthis.epubConfig.sections.push(section);\n\t\tArray.prototype.push.apply(this.epubConfig.toc, section.collectToc());\n\t\tArray.prototype.push.apply(this.epubConfig.landmarks, section.collectLandmarks());\n\t\treturn this;\n\t}\n\n\twithAdditionalFile(fileUrl, folder, filename)\n\t{\n\t\tlet _file = parseFileSetting(fileUrl, this.epubConfig) as ICover;\n\n\t\t_file = Object.assign({}, _file, {\n\t\t\tfolder: folder,\n\t\t\tname: filename\n\t\t});\n\n\t\tthis.epubConfig.additionalFiles.push(_file);\n\n\t\treturn this;\n\t}\n\n\twithOption(key: string, value)\n\t{\n\t\tthis.epubConfig.options[key] = value;\n\t\treturn this;\n\t}\n\n\twithInfoPreface(str: string)\n\t{\n\t\tif (str)\n\t\t{\n\t\t\tthis.epubConfig.infoPreface = str.toString();\n\t\t}\n\n\t\treturn this;\n\t}\n\n\taddIdentifier(type: string, id?: string)\n\t{\n\t\tthis.epubConfig.addIdentifier(type, id);\n\t\treturn this;\n\t}\n\n\taddLinks(links, rel?: string)\n\t{\n\t\tconst self = this;\n\n\t\tlinks = Array.isArray(links) ? links.slice() : [links];\n\n\t\tlinks.forEach(function (url)\n\t\t{\n\t\t\tif (url)\n\t\t\t{\n\t\t\t\tself.epubConfig.addLink(url, rel);\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n\n\taddTag(tag)\n\t{\n\t\ttag = (Array.isArray(tag) ? tag : [tag]).reduce(function (a, b)\n\t\t{\n\t\t\tif (Array.isArray(b))\n\t\t\t{\n\t\t\t\treturn a.concat(b);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ta.push(b);\n\t\t\t}\n\n\t\t\treturn a;\n\t\t}, []);\n\n\t\tthis.epubConfig.tags = (this.epubConfig.tags || []).concat(tag);\n\t\treturn this;\n\t}\n\n\tsetPublicationDate(new_data?)\n\t{\n\t\tlet data = moment(new_data);\n\n\t\tthis.epubConfig.publication = data;\n\t\tthis.epubConfig.publicationDate = data.format(EpubMaker.dateFormat);\n\t\tthis.epubConfig.publicationDateYMD = data.format('YYYY-MM-DD');\n\n\t\treturn this;\n\t}\n\n\tsetVertical(vertical?: boolean | EnumEpubConfigVertical)\n\t{\n\t\tthis.epubConfig.vertical = vertical;\n\n\t\treturn this;\n\t}\n\n\tgetFilename(useTitle?: boolean, noExt?: boolean): string\n\t{\n\t\tlet ext = this.epubConfig.options.ext || EpubMaker.defaultExt;\n\t\tlet filename;\n\n\t\tif (this.epubConfig.filename)\n\t\t{\n\t\t\tfilename = this.epubConfig.filename;\n\t\t}\n\t\telse if (useTitle && this.epubConfig.title_short)\n\t\t{\n\t\t\tfilename = this.epubConfig.title_short;\n\t\t}\n\t\telse if (useTitle && this.epubConfig.title)\n\t\t{\n\t\t\tfilename = this.epubConfig.title;\n\t\t}\n\t\telse if (!this.epubConfig.slug)\n\t\t{\n\t\t\t// @ts-ignore\n\t\t\tthis.epubConfig.slug = shortid();\n\n\t\t\tfilename = this.epubConfig.slug;\n\t\t}\n\t\telse\n\t\t{\n\n\n\t\t\tfilename = this.epubConfig.slug;\n\t\t}\n\n\t\treturn trimFilename(filename) + (noExt ? '' : ext);\n\t}\n\n\tvaild()\n\t{\n\t\tlet ret: string[] = [];\n\n\t\tif (!this.epubConfig.title || !this.epubConfig.slug)\n\t\t{\n\t\t\tret.push('title, slug');\n\t\t}\n\n\t\tif (ret.length)\n\t\t{\n\t\t\treturn ret;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tbuild(options?)\n\t{\n\t\tlet self = this;\n\n\t\tif (!this.epubConfig.publication)\n\t\t{\n\t\t\tthis.setPublicationDate();\n\t\t}\n\n\t\tif (!this.epubConfig.uuid)\n\t\t{\n\t\t\tthis.withUuid(createUUID(this.epubConfig));\n\t\t}\n\n\t\tthis.epubConfig.$auto();\n\n\t\tlet chk = this.vaild();\n\n\t\tif (chk)\n\t\t{\n\t\t\tthrow chk;\n\t\t}\n\n\t\t[]\n\t\t\t.concat(this.epubConfig.sections, this.epubConfig.toc, this.epubConfig.landmarks)\n\t\t\t.forEach(function (section: EpubMaker.Section, index)\n\t\t\t{\n\t\t\t\tsection._EpubMaker_ = self;\n\t\t\t})\n\t\t;\n\n\t\treturn templateManagers.exec(this.epubConfig.templateName, this, options);\n\t}\n\n\t/**\n\t * for node.js\n\t *\n\t * @param options\n\t * @returns {Promise<T>}\n\t */\n\tmakeEpub<T = Buffer | Blob>(options?): Promise<T | any | Buffer | Blob>\n\t{\n\t\tlet self = this;\n\n\t\t// @ts-ignore\n\t\treturn this.build(options).then(async function (epubZip)\n\t\t{\n\t\t\tlet generateOptions = Object.assign({\n\t\t\t\ttype: 'nodebuffer',\n\t\t\t\tmimeType: 'application/epub+zip',\n\t\t\t\tcompression: 'DEFLATE',\n\t\t\t\tcompressionOptions: {\n\t\t\t\t\tlevel: 9\n\t\t\t\t},\n\t\t\t}, self.epubConfig.options.generateOptions, options);\n\n\t\t\tconsole.info('generating epub for: ' + self.epubConfig.title);\n\t\t\tlet content = await epubZip.generateAsync(generateOptions);\n\n\t\t\treturn content;\n\t\t});\n\t}\n}\n\nexport interface ISectionConfig\n{\n\tlang?: string;\n}\n\nexport interface ISectionContent\n{\n\ttitle?: string;\n\tcontent?: string;\n\n\trenderTitle?: boolean;\n\n\tcover?: {\n\t\tname?: string,\n\t\turl?: string,\n\t}\n}\n\nexport interface ISlugify\n{\n\t(input: string, ...argv): string\n}\n\nexport namespace EpubMaker\n{\n\texport let defaultExt = '.epub';\n\texport let dateFormat = 'YYYY-MM-DDTHH:mm:ss.SSSZ';\n\n\t// epubtypes and descriptions, useful for vendors implementing a GUI\n\t// @ts-ignore\n\texport const epubtypes = require('./epub-types.js');\n\n\t// @ts-ignore\n\texport let libSlugify = _slugify as ISlugify;\n\n\t/**\n\t * @epubType Optional. Allows you to add specific epub type content such as [epub:type=\"titlepage\"]\n\t * @id Optional, but required if section should be included in toc and / or landmarks\n\t * @content Optional. Should not be empty if there will be no subsections added to this section. Format: { title, content, renderTitle }\n\t */\n\texport class Section\n\t{\n\t\tpublic _EpubMaker_: EpubMaker;\n\n\t\tpublic epubType;\n\t\tpublic id;\n\t\tpublic content: ISectionContent;\n\t\tpublic includeInToc: boolean;\n\t\tpublic includeInLandmarks: boolean;\n\t\tpublic subSections: Section[] = [];\n\n\t\tpublic sectionConfig: ISectionConfig = {};\n\n\t\tpublic parentSection: Section;\n\t\tpublic parentEpubMaker: EpubMaker;\n\n\t\tconstructor(epubType, id, content, includeInToc?: boolean, includeInLandmarks?: boolean, ...argv)\n\t\t{\n\t\t\tthis.epubType = epubType;\n\t\t\tthis.id = id;\n\n\t\t\tthis.includeInToc = includeInToc;\n\t\t\tthis.includeInLandmarks = includeInLandmarks;\n\t\t\tthis.subSections = [];\n\n\t\t\t/*\n\t\t\tthis.content = content;\n\t\t\tif (content)\n\t\t\t{\n\t\t\t\tcontent.renderTitle = content.renderTitle !== false; // 'undefined' should default to true\n\t\t\t}\n\t\t\t*/\n\n\t\t\tthis.setContent(content, true);\n\t\t}\n\n\t\t/**\n\t\t *\n\t\t * @param {ISectionContent|string} content\n\t\t * @param {boolean} allow_null\n\t\t * @returns {this}\n\t\t */\n\t\tsetContent(content: ISectionContent, allow_null?: boolean)\n\t\t{\n\t\t\tlet o = {} as ISectionContent;\n\n\t\t\tif (typeof content == 'string')\n\t\t\t{\n\t\t\t\to.content = content;\n\t\t\t}\n\t\t\telse if (content.title || content.content || content.renderTitle || content.cover)\n\t\t\t{\n\t\t\t\to = content;\n\t\t\t}\n\n\t\t\tif (Object.keys(o).length)\n\t\t\t{\n\t\t\t\tif (this.content)\n\t\t\t\t{\n\t\t\t\t\tthis.content = Object.assign(this.content, o);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.content = o;\n\t\t\t\t}\n\n\t\t\t\tthis.content.renderTitle = this.content.renderTitle !== false;\n\n\t\t\t} else if (content)\n\t\t\t{\n\t\t\t\tthis.content = content;\n\t\t\t}\n\t\t\telse if (!allow_null)\n\t\t\t{\n\t\t\t\tthrow new ReferenceError();\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\tget epubTypeGroup()\n\t\t{\n\t\t\treturn epubtypes.getGroup(this.epubType);\n\t\t}\n\n\t\tget lang()\n\t\t{\n\t\t\treturn this.sectionConfig.lang || (this._EpubMaker_ ? this._EpubMaker_.lang : null) || null;\n\t\t}\n\n\t\tget langMain()\n\t\t{\n\t\t\treturn (this._EpubMaker_ ? this._EpubMaker_.lang : null) || null;\n\t\t}\n\n\t\tstatic create(epubType, id, content, includeInToc: boolean, includeInLandmarks: boolean, ...argv)\n\t\t{\n\t\t\treturn new this(epubType, id, content, includeInToc, includeInLandmarks, ...argv);\n\t\t}\n\n\t\t/**\n\t\t * 用來檢查 Section 是否已經加入\n\t\t */\n\t\thasSubSection(subsection: Section): boolean\n\t\t{\n\t\t\treturn this.subSections.includes(subsection);\n\t\t}\n\n\t\twithSubSection(subsection: Section)\n\t\t{\n\t\t\tsubsection.parentSection = this;\n\n\t\t\tthis.subSections.push(subsection);\n\t\t\treturn this;\n\t\t};\n\n\t\tcollectToc()\n\t\t{\n\t\t\treturn this.collectSections(this, 'includeInToc');\n\t\t}\n\n\t\tcollectLandmarks()\n\t\t{\n\t\t\treturn this.collectSections(this, 'includeInLandmarks');\n\t\t}\n\n\t\tcollectSections(section: Section, prop: string): Section[]\n\t\t{\n\t\t\tlet sections = section[prop] ? [section] : [];\n\t\t\tfor (let i = 0; i < section.subSections.length; i++)\n\t\t\t{\n\t\t\t\tArray.prototype.push.apply(sections, this.collectSections(section.subSections[i], prop));\n\t\t\t}\n\t\t\treturn sections;\n\t\t}\n\t}\n}\n\nexport default EpubMaker;\n\nif (typeof window !== 'undefined')\n{\n\t// @ts-ignore\n\twindow.EpubMaker = EpubMaker;\n}\n"]}